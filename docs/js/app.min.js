!function e(t,r,n){function i(o,u){if(!r[o]){if(!t[o]){var s="function"==typeof require&&require;if(!u&&s)return s(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n=t.hash.type||"middle",i="",a=Number(e.pageCount),o=Number(e.page);t.hash.limit&&(r=+t.hash.limit);var u={};switch(n){case"middle":if("number"==typeof r){var s=0,c=Math.ceil(r/2)-1,l=r-c-1;o+l>a&&(c=r-(a-o)-1),o-c<1&&(c=o-1);for(var f=o-c;s<r&&s<a;)u={n:f},f===o&&(u.active=!0),i+=t.fn(u),f++,s++}else for(var s=1;s<=a;s++)u={n:s},s===o&&(u.active=!0),i+=t.fn(u);break;case"previous":u=1===o?{disabled:!0,n:1}:{n:o-1},i+=t.fn(u);break;case"next":u={},u=o===a?{disabled:!0,n:a}:{n:o+1},i+=t.fn(u);break;case"first":u=1===o?{disabled:!0,n:1}:{n:1},i+=t.fn(u);break;case"last":u=o===a?{disabled:!0,n:a}:{n:a},i+=t.fn(u)}return i}},{}],2:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.App=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./controllers"),o=e("./environments/firebase-config"),u=e("./router"),s=e("./services"),c=e("./utils");r.App=function(){function e(){n(this,e),this._firebaseApp=firebase.initializeApp(o.firebaseConfig),this._utils=(new c.UtilsFactory).getAll(),this._services=new s.ServicesFactory(this._firebaseApp,this._utils).getAll(),this._controllers=new a.ControllersFactory(this._services,this._utils).getAll(),this._router=new u.Router(this._controllers);this._services.postsService.findPostsByTitle("asd").subscribe(console.log)}return i(e,[{key:"initialize",value:function(){this._utils.templatesLoader.get("home").then(function(e){$("main").html(e())}),console.log("initialize app"),this._router.run("#/home")}}]),e}()},{"./controllers":4,"./environments/firebase-config":8,"./router":10,"./services":13,"./utils":16}],3:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.AuthController=function(){function e(t){var r=t.authService;n(this,e),this._authService=r}return i(e,[{key:"regiser",value:function(){}},{key:"login",value:function(){}},{key:"logout",value:function(){}}]),e}()},{}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ControllersFactory=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./auth-controller"),o=e("./main-controller"),u=e("./posts-controller"),s=e("./users-controller");r.ControllersFactory=function(){function e(t,r){var i=r.templatesLoader;n(this,e),this._services=t,this._templatesLoader=i}return i(e,[{key:"getAll",value:function(){return{authController:new a.AuthController(this._services,this._templatesLoader),mainController:new o.MainController(this._services,this._templatesLoader),postsController:new u.PostsController(this._services,this._templatesLoader),usersController:new s.UsersController(this._services,this._templatesLoader)}}}]),e}()},{"./auth-controller":3,"./main-controller":5,"./posts-controller":6,"./users-controller":7}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.MainController=function(){function e(){n(this,e)}return i(e,[{key:"getHome",value:function(){}},{key:"getAbout",value:function(){}}]),e}()},{}],6:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.PostsController=function(){function e(t){var r=t.postsService;n(this,e),this._postsService=r}return i(e,[{key:"get",value:function(){}},{key:"getByCategory",value:function(){}},{key:"findByTitle",value:function(){}},{key:"getAll",value:function(){}},{key:"add",value:function(){}},{key:"update",value:function(){}}]),e}()},{}],7:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.UsersController=function(){function e(t){var r=t.usersService;n(this,e),this._usersService=r}return i(e,[{key:"save",value:function(){}}]),e}()},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.firebaseConfig={apiKey:"AIzaSyD57uhi77W5dNCFej6dorJ0TL29BQJPt98",authDomain:"healthy-world-6d410.firebaseapp.com",databaseURL:"https://healthy-world-6d410.firebaseio.com",storageBucket:"healthy-world-6d410.appspot.com",messagingSenderId:"980620370836"}},{}],9:[function(e,t,r){"use strict";var n=e("./app");$(document).ready(function(){var e=new n.App;e.initialize()})},{"./app":2}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.Router=function(){function e(t){t.authController,t.categoriesController,t.mainController,t.postsController,t.usersController;n(this,e),this._router=Sammy("main",function(){this.get("#/",function(){this.redirect("#/home")}),this.get("#/home",function(e){console.log("App works")})})}return i(e,[{key:"run",value:function(e){this._router.run(e)}}]),e}()},{}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.AuthService=function(){function e(t){var r=this;n(this,e),this._firebaseAuth=t.auth(),this._firebaseAuth.onAuthStateChanged(function(e){r._authState=e})}return i(e,[{key:"signUpUser",value:function(e,t){return this._firebaseAuth.createUserWithEmailAndPassword(e,t)}},{key:"signInUser",value:function(e,t){return this._firebaseAuth.signInWithEmailAndPassword(e,t)}},{key:"signInWithFacebook",value:function(){var e=new this._firebaseAuth.app.I.auth.FacebookAuthProvider;return this._firebaseAuth.signInWithPopup(e)}},{key:"signOut",value:function(){return this._firebaseAuth.signOut()}},{key:"isAuthenticated",get:function(){return!!this._authState}},{key:"userId",get:function(){return this.isAuthenticated?this._authState.uid:"5w7o9b4Ad2UPIJLOZ9vUCF06gem1"}}]),e}()},{}],12:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.DataService=function(){function e(t){n(this,e),this._databaseRef=t.database().ref(),this._storageRef=t.storage().ref()}return i(e,[{key:"_setQuery",value:function(e,t){return t.orderByKey?e=e.orderByKey():t.orderByValue?e=e.orderByValue():t.orderByChild&&(e=e.orderByChild(t.orderByChild)),t.startAt||t.endAt?(e=t.startAt?e.startAt(t.startAt):e,e=t.endAt?e.endAt(t.endAt):e):t.equalTo&&(e=e.equalTo(t.equalTo)),t.limitToFirst?e=e.limitToFirst(t.limitToFirst):t.limitToLast&&(e=e.limitToLast(t.limitToLast)),e}},{key:"getObject",value:function(e,t){var r=this._databaseRef.child(e);return r=t?this._setQuery(r,t):r,Rx.Observable.create(function(e){try{r.on("value",function(t){e.next(t.val())})}catch(t){e.error(t)}})}},{key:"getList",value:function(e,t){return this.getObject(e,t).map(function(e){return e?Object.keys(e).map(function(t){return{$key:t,val:e[t]}}):[]})}},{key:"save",value:function(e,t){return this._databaseRef.child(e).push(t)}},{key:"update",value:function(e,t){var r={};return r[e]=t||!0,this._databaseRef.update(r)}},{key:"getStorageItemRef",value:function(e){return this._storageRef.child(e)}},{key:"saveStorageItem",value:function(e,t){var r=this.getStorageItemRef(e);return r.put(t)}}]),e}()},{}],13:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ServicesFactory=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./auth-service"),o=e("./data-service"),u=e("./posts-service"),s=e("./users-service");r.ServicesFactory=function(){function e(t,r){n(this,e),this._app=t,this._utils=r}return i(e,[{key:"getAll",value:function(){var e=new o.DataService(this._app),t=new a.AuthService(this._app),r=new s.UsersService(e),n=new u.PostsService({authService:t,dataService:e,usersService:r},this._utils);return{authService:t,dataService:e,postsService:n,usersService:r}}}]),e}()},{"./auth-service":11,"./data-service":12,"./posts-service":14,"./users-service":15}],14:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.PostsService=function(){function e(t,r){var i=t.authService,a=t.dataService,o=t.usersService,u=r.keyGenerator;n(this,e),this.postsUrl="posts",this._authService=i,this._dataService=a,this._usersService=o,this._keyGenerator=u}return i(e,[{key:"_findPostsKeysByUserKey",value:function(e){var t=this.postsUrl+"PerUser/"+e;return this._dataService.getList(t).map(function(e){return e.map(function(e){return e.$key})})}},{key:"_savePost",value:function(e){var t=this,r=this._authService.userId,n=(new Date).toString();return this._usersService.getUserByKey(r).first().map(function(t){e.userId=r,e.username=t.name,e.added=n}).map(function(){return t._dataService.save(t.postsUrl,e)}).map(function(r){var n=r.key,i=t.postsUrl+"PerCategory/"+e.category+"/"+n;return t._dataService.update(i),n}).map(function(e){var n=t.postsUrl+"PerUser/"+r+"/"+e;return t._dataService.update(n),e}).map(function(r){var n="recentPosts/"+r;return t._dataService.update(n,e.title),r}).map(function(r){if(e.imageUrl){var n="media/"+r,i={type:"img",desc:e.desc,url:e.imageUrl};t._dataService.update(n,i)}return r}).toPromise()}},{key:"_savePostImage",value:function(e){var t=this._keyGenerator.generate();return this._dataService.saveStorageItem(t,e).then(function(e){return e.downloadURL})}},{key:"createPost",value:function(e,t){var r=this;return t?this._savePostImage(t).then(function(t){e.imageUrl=t}).then(function(){return r._savePost(e)}):this._savePost(e)}},{key:"updatePost",value:function(e,t,r){var n=this,i=e.key;return r?this._savePostImage(r).then(function(e){t.imageUrl=e}).then(function(){return n._dataService.update(i,t)}):this._dataService.update(i,t)}},{key:"findPostByKey",value:function(e){var t=this.postsUrl+"/"+e;return this._dataService.getObject(t)}},{key:"findPostsByKeys",value:function(e){var t=this;return console.log(e),Array.isArray(e)&&(e=Rx.Observable.of(e)),e.map(function(e){return e.map(function(e){return t.findPostByKey(e)})}).flatMap(function(e){return Rx.Observable.combineLatest(e)})}},{key:"findPostsByTitle",value:function(e){var t=this;return this._dataService.getList("recentPosts").map(function(t){return t.filter(function(t){return t.val.toLowerCase().indexOf(e)>-1}).map(function(e){return e.$key})}).flatMap(function(e){return t.findPostsByKeys(e)})}},{key:"findAllPosts",value:function(e){if(e){var t={limitToLast:e};return this._dataService.getList(this.postsUrl,t)}return this._dataService.getList(this.postsUrl)}},{key:"findFirstPosts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t={limitToFirst:e};return this._dataService.getList("recentPosts",t)}},{key:"findLastPosts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t={limitToLast:e};return this._dataService.getList("recentPosts",t)}},{key:"findPostsKeysByCategory",value:function(e){var t=this.postsUrl+"PerCategory/"+e;return this._dataService.getList(t).map(function(e){return e.map(function(e){return e.$key})})}},{key:"findPostsByUserKey",value:function(e){return this.findPostsByKeys(this._findPostsKeysByUserKey(e))}}]),e}()},{}],15:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.UsersService=function(){function e(t){n(this,e),this._dataService=t,this._usersUrl="users"}return i(e,[{key:"createUser",value:function(e,t){var r=this._usersUrl+"/"+e,n={};return n[r]=t,this._dataService.update(n)}},{key:"updateUser",value:function(e,t){var r=this._usersUrl+"/"+e,n={};return n[r]=t,this._dataService.update(n)}},{key:"getAllUsers",value:function(e){return this._dataService.getList(this._usersUrl,e)}},{key:"getUserByKey",value:function(e){var t=this._usersUrl+"/"+e;return this._dataService.getObject(t)}}]),e}()},{}],16:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.UtilsFactory=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./key-generator"),o=e("./templates-loader");r.UtilsFactory=function(){function e(){n(this,e)}return i(e,[{key:"getAll",value:function(){return{keyGenerator:new a.KeyGenerator,templatesLoader:new o.TemplatesLoader}}}]),e}()},{"./key-generator":17,"./templates-loader":18}],17:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r.KeyGenerator=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;n(this,e),this._chars="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM!@()_-1234567890",this._timestampLength=13,this._length=t-this._timestampLength}return i(e,[{key:"_getRandomNumber",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return Math.floor(Math.random()*(t-e))+e}},{key:"generate",value:function(){for(var e=(+new Date).toString(),t=e,r=0;r<this._length;r+=1){var n=this._getRandomNumber(0,this._chars.length),i=this._chars[n];t+=i}return t}}]),e}()},{}],18:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.TemplatesLoader=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("../../bower_components/handlebars-paginate/index"),u=n(o);r.TemplatesLoader=function(){function e(){i(this,e),this._handlebars=window.Handlebars,this._cache={},this._handlebars.registerHelper("paginate",u.default)}return a(e,[{key:"get",value:function(e){var t=this,r=new Promise(function(r,n){if(t._cache[e])return void r(t._cache[e]);var i="templates/"+e+".handlebars";$.get(i,function(n){var i=t._handlebars.compile(n);t._cache[e]=i,r(i)}).fail(function(){return n("Cannot load the template")})});return r}}]),e}()},{"../../bower_components/handlebars-paginate/index":1}]},{},[9]);